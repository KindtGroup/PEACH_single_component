# Partition-enabled Analysis of Cluster Histograms (PEACH) Analysis for Extraction of Cluster Free Energy of Nucleation or Micellization Process
<p style="text-align: left;"> Created by Kindt Group, Emory University</p>
<p style="text-align: left;"> Code Author: Dr. Lara Patel and Dr. James Kindt </p>

## Table of Contents
- [Introduction](#introduction)
- [Input Files](#input-files)
- [Compile and run the f90 code](#compile-and-run-the-f90-code)
- [Output Files](#output-files)
- [Second Pass](#second-pass)

<!-- /TOC -->

## Introduction
PEACH method provides a versatile tool to analyze the cluster free energy and cluster size distribution based on cluster histograms generated by molecular dynamics (MD) simulations. </br> 
</br>
**For further background information, please refer to the following literature. Please cite the following literature if you use the code.** </br> 
Kindt, J. T., Determining Bulk Equilibrium Constants for Cluster Formation from Constant NVT Ensemble Simulations at Small N. *Physics Procedia 2014, 53, 63-70*.</br>
Patel, L. A.; Kindt, J. T., Simulations of NaCl Aggregation from Solution: Solvent Determines Topography of Free Energy Landscape. *Journal of computational chemistry 2019, 40 (1), 135-147*. </br>
Zhang, X.;  Arce Nunez, J. G.; Kindt, J. T., Derivation of micelle size-dependent free energies of aggregation for octyl phosphocholine from molecular dynamics simulation. *Fluid Phase Equilibria 2019, 485, 83-93*.
</br>

## Input Files
- An input file is needed for running the analysis.A further explanation on the format of input is included in the f90 files. Input file should include
    - A line indicating ($Total number of datasets,$Number of interation,$Alpha value,$Monomer concentration for output cluster free energy)
    - One or several datasets of cluster histograms with a line indicating ($Total number of surfactants, $Total number of counterions, $Number of lines,Volume) before the histogram. 
- Sample input: input.txt (This is a collection of cluster histograms for octyl phosphocholine.)

## Compile and run the f90 code
```
gfortran -O3 Multiset-FirstPass-vs006.f90 -o MS-FP.exe 
./MS-FP.exe < input.txt
```
## Output Files
- All output files have a prefix of "MS".
- You can read convergence criteria, cluster free energy and cluster size distribution from corresponding output files.

## Second Pass
- There are two ways that we consider to update the equilibrium constants throughout iterations. If you want to increase the accuracy of the cluster free energy, you should consider a second pass. 
  - The first pass used the relative weight of the standard deviation in the cluster frequency such that each entry to the geometric mean calculated from K_apparent is weighted relative to the data quality of that cluster sizes. For a cluster size i,
    ```
    NrelW(i)=Nstdv(i)/Navg(i)       (w(i)=1/NrelW(i))
    ```
  - The second pass used the relative weight based on the two standard deviations.
    ```
    KrelW(i)=NrelW(i)/(NrelW(1)**i) (w(i)=1/KrelW(i))
    ```
- For the second pass, the input includes   
    - One line indicating ($Total number of datasets,$Number of interation,$Alpha value,$Monomer concentration for output cluster free energy)
    - One line indicating $Total number of lines of K
    - A table of cluster size and corresponding equilibrium constants K
    - The above concatanates the input file of cluster histograms from the first pass
- Sample input: input-SP.txt
- The f90 code is compiled in the same way.
- Same output files are generated.

